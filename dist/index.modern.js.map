{"version":3,"file":"index.modern.js","sources":["../ReactRailsHotReload.js","../ReactRailsHotReloadConfig.js"],"sourcesContent":["import { AppContainer } from \"react-hot-loader\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport _ from \"lodash\";\n\nconst components = {};\n\nexport default class ReactRailsHotReload {\n  static init(module, webpackRequire) {\n    window.ReactRailsUJS.mountComponents = ReactRailsHotReload.mountComponents;\n\n    if (module.hot) {\n      module.hot.accept(ReactRailsHotReload.hmrModules(), (updatedDeps) => {\n        ReactRailsHotReload.fixDeps(updatedDeps).forEach((dep) =>\n          webpackRequire(dep)\n        );\n        window.ReactRailsUJS.mountComponents();\n      });\n    }\n  }\n\n  static fixDeps(deps) {\n    return _(deps).flatten().uniq().value();\n  }\n\n  static hmrModules() {\n    return HMR_MODULES.map((dep) => require.context(\"../\").resolve(dep));\n  }\n\n  static mountComponents(searchSelector) {\n    let ujs = window.ReactRailsUJS;\n    let nodes = ujs.findDOMNodes(searchSelector);\n    for (let i = 0; i < nodes.length; ++i) {\n      let node = nodes[i];\n      let className = node.getAttribute(ujs.CLASS_NAME_ATTR);\n      let constructor = ujs.getConstructor(className);\n      let propsJson = node.getAttribute(ujs.PROPS_ATTR);\n      let props = propsJson && JSON.parse(propsJson);\n      let hydrate = node.getAttribute(ujs.RENDER_ATTR);\n      let cacheId = node.getAttribute(ujs.CACHE_ID_ATTR);\n      let turbolinksPermanent = node.hasAttribute(\n        ujs.TURBOLINKS_PERMANENT_ATTR\n      );\n\n      if (!constructor) {\n        let message = \"Cannot find component: '\" + className + \"'\";\n        if (console && console.log) {\n          console.log(\n            \"%c[react-rails] %c\" + message + \" for element\",\n            \"font-weight: bold\",\n            \"\",\n            node\n          );\n        }\n        throw new Error(\n          message + \". Make sure your component is available to render.\"\n        );\n      } else {\n        let component = components[cacheId];\n        if (component === undefined) {\n          component = React.createElement(constructor, props);\n          if (turbolinksPermanent) {\n            components[cacheId] = component;\n          }\n        }\n        if (hydrate && typeof ReactDOM.hydrate === \"function\") {\n          ReactDOM.hydrate(<AppContainer>{component}</AppContainer>, node);\n        } else {\n          ReactDOM.render(<AppContainer>{component}</AppContainer>, node);\n        }\n      }\n    }\n  }\n}\n","import { join, relative } from \"path\";\nimport { readdirSync, statSync } from \"fs\";\n\nimport { merge } from \"webpack-merge\";\nimport webpack from \"webpack\";\n\nconst sourceDir = \"app/javascript\";\n\nexport default class ReactRailsHotReloadConfig {\n  constructor(webpackConfig) {\n    this.webpackConfig = webpackConfig;\n  }\n\n  walkSync(dir, fileList = []) {\n    readdirSync(dir).forEach((file) => {\n      const filePath = join(dir, file);\n      if (filePath.includes(\".DS_Store\")) return;\n      if (filePath.includes(\"packs\")) return;\n      statSync(filePath).isDirectory()\n        ? (fileList = this.walkSync(filePath, fileList))\n        : fileList.push(`./${relative(sourceDir, filePath)}`);\n    });\n    return fileList;\n  }\n\n  packFiles() {\n    return this.walkSync(sourceDir);\n  }\n\n  entries() {\n    return Object.keys(this.webpackConfig.entry).reduce((accu, key) => {\n      accu[key] = [\"react-hot-loader/patch\", this.webpackConfig.entry[key]];\n      return accu;\n    }, {});\n  }\n\n  reactRailsHotReloadConfig() {\n    return {\n      devtool: \"cheap-eval-source-map\",\n      entry: this.entries(),\n      output: {\n        publicPath: \"http://localhost:3035/packs/\",\n      },\n      plugins: [\n        new webpack.DefinePlugin({\n          HMR_MODULES: JSON.stringify(this.packFiles()),\n        }),\n      ],\n      resolve: {\n        alias: {\n          \"react-dom\": \"@hot-loader/react-dom\",\n        },\n      },\n      watch: false,\n    };\n  }\n\n  merge(webpackConfig) {\n    this.webpackConfig = webpackConfig;\n    return merge(this.webpackConfig, this.reactRailsHotReloadConfig());\n  }\n}\n\nmodule.exports = ReactRailsHotReloadConfig;\n"],"names":["components","ReactRailsHotReload","[object Object]","module","webpackRequire","window","ReactRailsUJS","mountComponents","hot","accept","hmrModules","updatedDeps","fixDeps","forEach","dep","deps","_","flatten","uniq","value","HMR_MODULES","map","require","context","resolve","searchSelector","ujs","nodes","findDOMNodes","i","length","node","className","getAttribute","CLASS_NAME_ATTR","constructor","getConstructor","propsJson","PROPS_ATTR","props","JSON","parse","hydrate","RENDER_ATTR","cacheId","CACHE_ID_ATTR","turbolinksPermanent","hasAttribute","TURBOLINKS_PERMANENT_ATTR","message","console","log","Error","component","undefined","React","createElement","ReactDOM","h","AppContainer","render","ReactRailsHotReloadConfig","webpackConfig","this","walkSync","dir","fileList","readdirSync","file","filePath","join","includes","statSync","isDirectory","push","relative","packFiles","entries","Object","keys","entry","reduce","accu","key","reactRailsHotReloadConfig","devtool","output","publicPath","plugins","webpack","DefinePlugin","stringify","alias","react-dom","watch","merge","exports"],"mappings":"0QAKA,MAAMA,EAAa,SAEEC,EACnBC,YAAYC,EAAQC,GAClBC,OAAOC,cAAcC,gBAAkBN,EAAoBM,gBAEvDJ,EAAOK,KACTL,EAAOK,IAAIC,OAAOR,EAAoBS,aAAeC,IACnDV,EAAoBW,QAAQD,GAAaE,QAASC,GAChDV,EAAeU,IAEjBT,OAAOC,cAAcC,oBAK3BL,eAAea,GACb,OAAOC,EAAED,GAAME,UAAUC,OAAOC,QAGlCjB,oBACE,OAAOkB,YAAYC,IAAKP,GAAQQ,QAAQC,QAAQ,OAAOC,QAAQV,IAGjEZ,uBAAuBuB,GACrB,IAAIC,EAAMrB,OAAOC,cACbqB,EAAQD,EAAIE,aAAaH,GAC7B,IAAK,IAAII,EAAI,EAAGA,EAAIF,EAAMG,SAAUD,EAAG,CACrC,IAAIE,EAAOJ,EAAME,GACbG,EAAYD,EAAKE,aAAaP,EAAIQ,iBAClCC,EAAcT,EAAIU,eAAeJ,GACjCK,EAAYN,EAAKE,aAAaP,EAAIY,YAClCC,EAAQF,GAAaG,KAAKC,MAAMJ,GAChCK,EAAUX,EAAKE,aAAaP,EAAIiB,aAChCC,EAAUb,EAAKE,aAAaP,EAAImB,eAChCC,EAAsBf,EAAKgB,aAC7BrB,EAAIsB,2BAGN,IAAKb,EAAa,CAChB,IAAIc,EAAU,2BAA6BjB,EAAY,IASvD,MARIkB,SAAWA,QAAQC,KACrBD,QAAQC,IACN,qBAAuBF,EAAU,eACjC,oBACA,GACAlB,OAGMqB,MACRH,EAAU,sDAEP,CACL,IAAII,EAAYrD,EAAW4C,QACTU,IAAdD,IACFA,EAAYE,EAAMC,cAAcrB,EAAaI,GACzCO,IACF9C,EAAW4C,GAAWS,IAGtBX,GAAuC,mBAArBe,EAASf,QAC7Be,EAASf,QAAQgB,EAACC,OAAcN,GAA2BtB,GAE3D0B,EAASG,OAAOF,EAACC,OAAcN,GAA2BtB,MC5DpE,MAAqB8B,EACnB1B,YAAY2B,GACVC,KAAKD,cAAgBA,EAGvBE,SAASC,EAAKC,EAAW,IASvB,OARAC,EAAYF,GAAKpD,QAASuD,IACxB,MAAMC,EAAWC,EAAKL,EAAKG,GACvBC,EAASE,SAAS,cAClBF,EAASE,SAAS,WACtBC,EAASH,GAAUI,cACdP,EAAWH,KAAKC,SAASK,EAAUH,GACpCA,EAASQ,KAAM,KAAIC,EAdX,iBAc+BN,OAEtCH,EAGTU,YACE,YAAYZ,SApBE,kBAuBhBa,UACE,OAAOC,OAAOC,KAAKhB,KAAKD,cAAckB,OAAOC,OAAO,CAACC,EAAMC,KACzDD,EAAKC,GAAO,CAAC,yBAA0BpB,KAAKD,cAAckB,MAAMG,IACzDD,GACN,IAGLE,4BACE,MAAO,CACLC,QAAS,wBACTL,MAAOjB,KAAKc,UACZS,OAAQ,CACNC,WAAY,gCAEdC,QAAS,CACP,IAAIC,EAAQC,aAAa,CACvBtE,YAAaoB,KAAKmD,UAAU5B,KAAKa,gBAGrCpD,QAAS,CACPoE,MAAO,CACLC,YAAa,0BAGjBC,OAAO,GAIXC,MAAMjC,GAEJ,OADAC,KAAKD,cAAgBA,EACdiC,EAAMhC,KAAKD,cAAeC,KAAKqB,8BAI1CjF,OAAO6F,QAAUnC"}
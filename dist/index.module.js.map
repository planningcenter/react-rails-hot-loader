{"version":3,"file":"index.module.js","sources":["../src/ReactRailsHotReload.js","../src/ReactRailsHotReloadConfig.js"],"sourcesContent":["import { AppContainer } from \"react-hot-loader\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport _ from \"lodash\";\n\nconst components = {};\n\nconst ReactRailsHotReload = {\n  init: function (module, webpackRequire) {\n    console.log(\"-----------------------------------------\");\n    console.log(window.ReactRailsUJS);\n    console.log(\"-----------------------------------------\");\n    // window.ReactRailsUJS.mountComponents = ReactRailsHotReload.mountComponents;\n\n    // if (module.hot) {\n    //   module.hot.accept(ReactRailsHotReload.hmrModules(), (updatedDeps) => {\n    //     ReactRailsHotReload.fixDeps(updatedDeps).forEach((dep) =>\n    //       webpackRequire(dep)\n    //     );\n    //     window.ReactRailsUJS.mountComponents();\n    //   });\n    // }\n  },\n\n  // fixDeps: function (deps) {\n  //   return _(deps).flatten().uniq().value();\n  // },\n\n  // hmrModules: function () {\n  //   return HMR_MODULES.map((dep) => require.context(\"../\").resolve(dep));\n  // },\n\n  // This is an exact copy of the mountComponents function in react-rails\n  // https://github.com/reactjs/react-rails/blob/v2.6.1/react_ujs/index.js#L85\n  // with the addition of the AppContainer wrapping at the end\n  // mountComponents: function (searchSelector) {\n  //   let ujs = window.ReactRailsUJS;\n  //   let nodes = ujs.findDOMNodes(searchSelector);\n  //   for (let i = 0; i < nodes.length; ++i) {\n  //     let node = nodes[i];\n  //     let className = node.getAttribute(ujs.CLASS_NAME_ATTR);\n  //     let constructor = ujs.getConstructor(className);\n  //     let propsJson = node.getAttribute(ujs.PROPS_ATTR);\n  //     let props = propsJson && JSON.parse(propsJson);\n  //     let hydrate = node.getAttribute(ujs.RENDER_ATTR);\n  //     let cacheId = node.getAttribute(ujs.CACHE_ID_ATTR);\n  //     let turbolinksPermanent = node.hasAttribute(\n  //       ujs.TURBOLINKS_PERMANENT_ATTR\n  //     );\n\n  //     if (!constructor) {\n  //       let message = \"Cannot find component: '\" + className + \"'\";\n  //       if (console && console.log) {\n  //         console.log(\n  //           \"%c[react-rails] %c\" + message + \" for element\",\n  //           \"font-weight: bold\",\n  //           \"\",\n  //           node\n  //         );\n  //       }\n  //       throw new Error(\n  //         message + \". Make sure your component is available to render.\"\n  //       );\n  //     } else {\n  //       let component = components[cacheId];\n  //       if (component === undefined) {\n  //         component = React.createElement(constructor, props);\n  //         if (turbolinksPermanent) {\n  //           components[cacheId] = component;\n  //         }\n  //       }\n  //       if (hydrate && typeof ReactDOM.hydrate === \"function\") {\n  //         ReactDOM.hydrate(\n  //           React.createElement(AppContainer, {}, component),\n  //           node\n  //         );\n  //       } else {\n  //         ReactDOM.render(\n  //           React.createElement(AppContainer, {}, component),\n  //           node\n  //         );\n  //       }\n  //     }\n  //   }\n  // },\n};\n\nexport default ReactRailsHotReload;\n","import { join, relative } from \"path\";\nimport { readdirSync, statSync } from \"fs\";\n\nimport { merge } from \"webpack-merge\";\nimport webpack from \"webpack\";\n\nconst sourceDir = \"app/javascript\";\n\nexport default class ReactRailsHotReloadConfig {\n  constructor(webpackConfig) {\n    this.webpackConfig = webpackConfig;\n  }\n\n  walkSync(dir, fileList = []) {\n    readdirSync(dir).forEach((file) => {\n      const filePath = join(dir, file);\n      if (filePath.includes(\".DS_Store\")) return;\n      if (filePath.includes(\"packs\")) return;\n      statSync(filePath).isDirectory()\n        ? (fileList = this.walkSync(filePath, fileList))\n        : fileList.push(`./${relative(sourceDir, filePath)}`);\n    });\n    return fileList;\n  }\n\n  packFiles() {\n    return this.walkSync(sourceDir);\n  }\n\n  entries() {\n    return Object.keys(this.webpackConfig.entry).reduce((accu, key) => {\n      accu[key] = [\"react-hot-loader/patch\", this.webpackConfig.entry[key]];\n      return accu;\n    }, {});\n  }\n\n  reactRailsHotReloadConfig() {\n    return {\n      devtool: \"cheap-eval-source-map\",\n      entry: this.entries(),\n      output: {\n        publicPath: \"http://localhost:3035/packs/\",\n      },\n      plugins: [\n        new webpack.DefinePlugin({\n          HMR_MODULES: JSON.stringify(this.packFiles()),\n        }),\n      ],\n      resolve: {\n        alias: {\n          \"react-dom\": \"@hot-loader/react-dom\",\n        },\n      },\n      watch: false,\n    };\n  }\n\n  merge(webpackConfig) {\n    this.webpackConfig = webpackConfig;\n    return merge(this.webpackConfig, this.reactRailsHotReloadConfig());\n  }\n}\n"],"names":["ReactRailsHotReload","init","module","webpackRequire","console","log","window","ReactRailsUJS","ReactRailsHotReloadConfig","webpackConfig","this","walkSync","dir","fileList","readdirSync","forEach","file","filePath","join","includes","statSync","isDirectory","_this","push","relative","packFiles","entries","Object","keys","entry","reduce","accu","key","_this2","reactRailsHotReloadConfig","devtool","output","publicPath","plugins","webpack","DefinePlugin","HMR_MODULES","JSON","stringify","resolve","alias","react-dom","watch","merge"],"mappings":"8NAOA,IAAMA,EAAsB,CAC1BC,KAAM,SAAUC,EAAQC,GACtBC,QAAQC,IAAI,6CACZD,QAAQC,IAAIC,OAAOC,eACnBH,QAAQC,IAAI,+CCHKG,aACnB,WAAYC,GACVC,KAAKD,cAAgBA,6BAGvBE,SAAA,SAASC,EAAKC,cASZ,gBATYA,IAAAA,EAAW,IACvBC,EAAYF,GAAKG,QAAQ,SAACC,GACxB,IAAMC,EAAWC,EAAKN,EAAKI,GACvBC,EAASE,SAAS,cAClBF,EAASE,SAAS,WACtBC,EAASH,GAAUI,cACdR,EAAWS,EAAKX,SAASM,EAAUJ,GACpCA,EAASU,UAAUC,EAdX,iBAc+BP,OAEtCJ,KAGTY,UAAA,WACE,YAAYd,SApBE,qBAuBhBe,QAAA,sBACE,OAAOC,OAAOC,KAAKlB,KAAKD,cAAcoB,OAAOC,OAAO,SAACC,EAAMC,GAEzD,OADAD,EAAKC,GAAO,CAAC,yBAA0BC,EAAKxB,cAAcoB,MAAMG,IACzDD,GACN,OAGLG,0BAAA,WACE,MAAO,CACLC,QAAS,wBACTN,MAAOnB,KAAKgB,UACZU,OAAQ,CACNC,WAAY,gCAEdC,QAAS,CACP,IAAIC,EAAQC,aAAa,CACvBC,YAAaC,KAAKC,UAAUjC,KAAKe,gBAGrCmB,QAAS,CACPC,MAAO,CACLC,YAAa,0BAGjBC,OAAO,MAIXC,MAAA,SAAMvC,GAEJ,OADAC,KAAKD,cAAgBA,EACduC,EAAMtC,KAAKD,cAAeC,KAAKwB"}
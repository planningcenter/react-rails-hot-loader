{"version":3,"file":"index.umd.js","sources":["../src/ReactRailsHotReload.js","../src/ReactRailsHotReloadConfig.js"],"sourcesContent":["import { AppContainer } from \"react-hot-loader\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport _ from \"lodash\";\n\nconst components = {};\n\nconst ReactRailsHotReload = {\n  init: function (module, webpackRequire) {\n    window.ReactRailsUJS.mountComponents = ReactRailsHotReload.mountComponents;\n\n    if (module.hot) {\n      module.hot.accept(ReactRailsHotReload.hmrModules(), (updatedDeps) => {\n        ReactRailsHotReload.fixDeps(updatedDeps).forEach((dep) =>\n          webpackRequire(dep)\n        );\n        window.ReactRailsUJS.mountComponents();\n      });\n    }\n  },\n\n  fixDeps: function (deps) {\n    return _(deps).flatten().uniq().value();\n  },\n\n  hmrModules: function () {\n    return HMR_MODULES.map((dep) => require.context(\"../\").resolve(dep));\n  },\n\n  // This is an exact copy of the mountComponents function in react-rails\n  // https://github.com/reactjs/react-rails/blob/v2.6.1/react_ujs/index.js#L85\n  // with the addition of the AppContainer wrapping at the end\n  mountComponents: function (searchSelector) {\n    let ujs = window.ReactRailsUJS;\n    let nodes = ujs.findDOMNodes(searchSelector);\n    for (let i = 0; i < nodes.length; ++i) {\n      let node = nodes[i];\n      let className = node.getAttribute(ujs.CLASS_NAME_ATTR);\n      let constructor = ujs.getConstructor(className);\n      let propsJson = node.getAttribute(ujs.PROPS_ATTR);\n      let props = propsJson && JSON.parse(propsJson);\n      let hydrate = node.getAttribute(ujs.RENDER_ATTR);\n      let cacheId = node.getAttribute(ujs.CACHE_ID_ATTR);\n      let turbolinksPermanent = node.hasAttribute(\n        ujs.TURBOLINKS_PERMANENT_ATTR\n      );\n\n      if (!constructor) {\n        let message = \"Cannot find component: '\" + className + \"'\";\n        if (console && console.log) {\n          console.log(\n            \"%c[react-rails] %c\" + message + \" for element\",\n            \"font-weight: bold\",\n            \"\",\n            node\n          );\n        }\n        throw new Error(\n          message + \". Make sure your component is available to render.\"\n        );\n      } else {\n        let component = components[cacheId];\n        if (component === undefined) {\n          component = React.createElement(constructor, props);\n          if (turbolinksPermanent) {\n            components[cacheId] = component;\n          }\n        }\n        if (hydrate && typeof ReactDOM.hydrate === \"function\") {\n          ReactDOM.hydrate(\n            React.createElement(AppContainer, {}, component),\n            node\n          );\n        } else {\n          ReactDOM.render(\n            React.createElement(AppContainer, {}, component),\n            node\n          );\n        }\n      }\n    }\n  },\n};\n\nexport default ReactRailsHotReload;\n","import { join, relative } from \"path\";\nimport { readdirSync, statSync } from \"fs\";\n\nimport { merge } from \"webpack-merge\";\nimport webpack from \"webpack\";\n\nconst sourceDir = \"app/javascript\";\n\nexport default class ReactRailsHotReloadConfig {\n  constructor(webpackConfig) {\n    this.webpackConfig = webpackConfig;\n  }\n\n  walkSync(dir, fileList = []) {\n    readdirSync(dir).forEach((file) => {\n      const filePath = join(dir, file);\n      if (filePath.includes(\".DS_Store\")) return;\n      if (filePath.includes(\"packs\")) return;\n      statSync(filePath).isDirectory()\n        ? (fileList = this.walkSync(filePath, fileList))\n        : fileList.push(`./${relative(sourceDir, filePath)}`);\n    });\n    return fileList;\n  }\n\n  packFiles() {\n    return this.walkSync(sourceDir);\n  }\n\n  entries() {\n    return Object.keys(this.webpackConfig.entry).reduce((accu, key) => {\n      accu[key] = [\"react-hot-loader/patch\", this.webpackConfig.entry[key]];\n      return accu;\n    }, {});\n  }\n\n  reactRailsHotReloadConfig() {\n    return {\n      devtool: \"cheap-eval-source-map\",\n      entry: this.entries(),\n      output: {\n        publicPath: \"http://localhost:3035/packs/\",\n      },\n      plugins: [\n        new webpack.DefinePlugin({\n          HMR_MODULES: JSON.stringify(this.packFiles()),\n        }),\n      ],\n      resolve: {\n        alias: {\n          \"react-dom\": \"@hot-loader/react-dom\",\n        },\n      },\n      watch: false,\n    };\n  }\n\n  merge(webpackConfig) {\n    this.webpackConfig = webpackConfig;\n    return merge(this.webpackConfig, this.reactRailsHotReloadConfig());\n  }\n}\n"],"names":["components","ReactRailsHotReload","init","module","webpackRequire","window","ReactRailsUJS","mountComponents","hot","accept","hmrModules","updatedDeps","fixDeps","forEach","dep","deps","_","flatten","uniq","value","HMR_MODULES","map","require","context","resolve","searchSelector","ujs","nodes","findDOMNodes","i","length","node","className","getAttribute","CLASS_NAME_ATTR","constructor","getConstructor","propsJson","PROPS_ATTR","props","JSON","parse","hydrate","RENDER_ATTR","cacheId","CACHE_ID_ATTR","turbolinksPermanent","hasAttribute","TURBOLINKS_PERMANENT_ATTR","message","console","log","Error","component","undefined","React","createElement","ReactDOM","AppContainer","render","ReactRailsHotReloadConfig","webpackConfig","this","walkSync","dir","fileList","readdirSync","file","filePath","join","includes","statSync","isDirectory","_this","push","relative","packFiles","entries","Object","keys","entry","reduce","accu","key","_this2","reactRailsHotReloadConfig","devtool","output","publicPath","plugins","webpack","DefinePlugin","stringify","alias","react-dom","watch","merge"],"mappings":"qyBAKA,IAAMA,EAAa,GAEbC,EAAsB,CAC1BC,KAAM,SAAUC,EAAQC,GACtBC,OAAOC,cAAcC,gBAAkBN,EAAoBM,gBAEvDJ,EAAOK,KACTL,EAAOK,IAAIC,OAAOR,EAAoBS,aAAc,SAACC,GACnDV,EAAoBW,QAAQD,GAAaE,QAAQ,SAACC,UAChDV,EAAeU,KAEjBT,OAAOC,cAAcC,qBAK3BK,QAAS,SAAUG,GACjB,OAAOC,EAAED,GAAME,UAAUC,OAAOC,SAGlCT,WAAY,WACV,OAAOU,YAAYC,IAAI,SAACP,UAAQQ,QAAQC,QAAQ,OAAOC,QAAQV,MAMjEP,gBAAiB,SAAUkB,GAGzB,IAFA,IAAIC,EAAMrB,OAAOC,cACbqB,EAAQD,EAAIE,aAAaH,GACpBI,EAAI,EAAGA,EAAIF,EAAMG,SAAUD,EAAG,CACrC,IAAIE,EAAOJ,EAAME,GACbG,EAAYD,EAAKE,aAAaP,EAAIQ,iBAClCC,EAAcT,EAAIU,eAAeJ,GACjCK,EAAYN,EAAKE,aAAaP,EAAIY,YAClCC,EAAQF,GAAaG,KAAKC,MAAMJ,GAChCK,EAAUX,EAAKE,aAAaP,EAAIiB,aAChCC,EAAUb,EAAKE,aAAaP,EAAImB,eAChCC,EAAsBf,EAAKgB,aAC7BrB,EAAIsB,2BAGN,IAAKb,EAAa,CAChB,IAAIc,EAAU,2BAA6BjB,EAAY,IASvD,MARIkB,SAAWA,QAAQC,KACrBD,QAAQC,IACN,qBAAuBF,EAAU,eACjC,oBACA,GACAlB,OAGMqB,MACRH,EAAU,sDAGZ,IAAII,EAAYrD,EAAW4C,QACTU,IAAdD,IACFA,EAAYE,EAAMC,cAAcrB,EAAaI,GACzCO,IACF9C,EAAW4C,GAAWS,IAGtBX,GAAuC,mBAArBe,EAASf,QAC7Be,EAASf,QACPa,EAAMC,cAAcE,eAAc,GAAIL,GACtCtB,GAGF0B,EAASE,OACPJ,EAAMC,cAAcE,eAAc,GAAIL,GACtCtB,MCpES6B,aACnB,WAAYC,GACVC,KAAKD,cAAgBA,6BAGvBE,SAAA,SAASC,EAAKC,cASZ,gBATYA,IAAAA,EAAW,IACvBC,cAAYF,GAAKnD,QAAQ,SAACsD,GACxB,IAAMC,EAAWC,OAAKL,EAAKG,GACvBC,EAASE,SAAS,cAClBF,EAASE,SAAS,WACtBC,WAASH,GAAUI,cACdP,EAAWQ,EAAKV,SAASK,EAAUH,GACpCA,EAASS,UAAUC,WAdX,iBAc+BP,OAEtCH,KAGTW,UAAA,WACE,YAAYb,SApBE,qBAuBhBc,QAAA,sBACE,OAAOC,OAAOC,KAAKjB,KAAKD,cAAcmB,OAAOC,OAAO,SAACC,EAAMC,GAEzD,OADAD,EAAKC,GAAO,CAAC,yBAA0BC,EAAKvB,cAAcmB,MAAMG,IACzDD,GACN,OAGLG,0BAAA,WACE,MAAO,CACLC,QAAS,wBACTN,MAAOlB,KAAKe,UACZU,OAAQ,CACNC,WAAY,gCAEdC,QAAS,CACP,IAAIC,EAAQC,aAAa,CACvBvE,YAAaoB,KAAKoD,UAAU9B,KAAKc,gBAGrCpD,QAAS,CACPqE,MAAO,CACLC,YAAa,0BAGjBC,OAAO,MAIXC,MAAA,SAAMnC,GAEJ,OADAC,KAAKD,cAAgBA,EACdmC,QAAMlC,KAAKD,cAAeC,KAAKuB"}